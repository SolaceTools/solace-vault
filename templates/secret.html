{% extends "base.html" %}
{% block title %}Secret Details{% endblock %}
{% block content %}
<div class="secret-view">
    <div class="secret-view-header">
        <h1>{{ secret.label }}</h1>
        <div class="secret-meta">
            <div class="meta-item">
                <span class="meta-label">Category</span>
                <span class="meta-value">{{ secret.category }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Tag</span>
                <span class="meta-value">{{ secret.tag if secret.tag else "No tag" }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Created</span>
                <span class="meta-value">{{ secret.created_at | format_timestamp }}</span>
            </div>
            
            <div class="meta-item">
                <span class="meta-label">Action</span>
                <button id="revealBtn" class="reveal-btn" onclick="revealSecret()">Reveal Secret</button>
            </div>
        </div>
    </div>

    <div class="secret-view-data">
        <div class="secret-content">
            <button class="copy-btn" onclick="copySecret()" title="Copy to clipboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                </svg>
            </button>
            <pre id="secretData" class="secret-data blurred">{{ plaintext }}</pre>
        </div>
    </div>

    <div class="secret-actions">
        <button type="button" class="btn btn-danger" onclick="openDeleteModal()">
            Delete Secret
        </button>
    </div>
</div>

<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h2>Confirm Deletion</h2>
        <p>Are you sure you want to delete "{{ secret.label }}"? This action cannot be undone.</p>
        <div class="modal-actions">
            <form action="{{ url_for('delete_secret', id=secret.id) }}" method="POST">
                <button type="submit" class="btn btn-danger">Delete Forever</button>
            </form>
            <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
    let isSecretRevealed = false;
    
    function revealSecret() {
        const secretData = document.getElementById('secretData');
        const revealBtn = document.getElementById('revealBtn');
        
        if (isSecretRevealed) {
            secretData.classList.add('blurred');
            revealBtn.textContent = 'Reveal Secret';
            isSecretRevealed = false;
        } else {
            secretData.classList.remove('blurred');
            revealBtn.textContent = 'Hide Secret';
            isSecretRevealed = true;
        }
    }
    
    function copySecret() {
        const secretText = `{{ plaintext }}`;
        navigator.clipboard.writeText(secretText).then(() => {
            const copyBtn = document.querySelector('.copy-btn');
            const originalHTML = copyBtn.innerHTML;
            copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/></svg>';
            copyBtn.style.color = '#10b981';
            
            setTimeout(() => {
                copyBtn.innerHTML = originalHTML;
                copyBtn.style.color = '';
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            alert('Failed to copy secret to clipboard');
        });
    }
</script>
{% endblock %}